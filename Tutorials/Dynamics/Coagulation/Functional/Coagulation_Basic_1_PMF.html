
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Coagulation Basic 1: PMF Representation &#8212; Particula Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Tutorials/Dynamics/Coagulation/Functional/Coagulation_Basic_1_PMF';</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/placeholder.png" class="logo__image only-light" alt="Particula Book - Home"/>
    <script>document.write(`<img src="../../../../_static/placeholder.png" class="logo__image only-dark" alt="Particula Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../intro.html">
                    Getting started
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Tour</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../tour/part-tour.html">Particula tour</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../documentation/environment.html">The <code class="docutils literal notranslate"><span class="pre">Environment</span></code> Class</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/dilution_loss.html"><code class="docutils literal notranslate"><span class="pre">dilution_loss</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/dynamic_viscosity.html"><code class="docutils literal notranslate"><span class="pre">dynamic_viscosity</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/mean_free_path.html">Mean Free Path</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation/vapor.html">The <code class="docutils literal notranslate"><span class="pre">Vapor</span></code> Class</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../documentation/particle.html">The <code class="docutils literal notranslate"><span class="pre">Particle</span></code> Classes</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/distribution_discretization.html"><code class="docutils literal notranslate"><span class="pre">distribution_discretization</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/radius_cutoff.html"><code class="docutils literal notranslate"><span class="pre">radius_cutoff</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/particle_mass.html"><code class="docutils literal notranslate"><span class="pre">particle_mass</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/knudsen_number.html"><code class="docutils literal notranslate"><span class="pre">knudsen_number</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/slip_correction.html"><code class="docutils literal notranslate"><span class="pre">slip_correction</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/friction_factor.html"><code class="docutils literal notranslate"><span class="pre">friction_factor</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/dimensionless_coagulation.html"><code class="docutils literal notranslate"><span class="pre">dimensionless_coagulation</span></code></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../documentation/utilities/utilities_overview.html">Utilities Functions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../documentation/utilities/convert_size_dist_scales.html">Converting Size Distributions</a></li>


</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Strategic Plan</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../strategic_plan/strategic_planning_FY24.html">FY24 Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../strategic_plan/Aerosol_patterns.html">Program Outline Revision Draft</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Next Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation/next/next_vapor_pressure.html">Vapor Pressure</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../CONTRIBUTING.html">Contributor Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uncscode/particula/v0.0.10?urlpath=lab/tree/docs/Tutorials/Dynamics/Coagulation/Functional/Coagulation_Basic_1_PMF.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/uncscode/particula/blob/v0.0.10/docs/Tutorials/Dynamics/Coagulation/Functional/Coagulation_Basic_1_PMF.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uncscode/particula" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uncscode/particula/edit/v0.0.10/docs/Tutorials/Dynamics/Coagulation/Functional/Coagulation_Basic_1_PMF.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uncscode/particula/issues/new?title=Issue%20on%20page%20%2FTutorials/Dynamics/Coagulation/Functional/Coagulation_Basic_1_PMF.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../_sources/Tutorials/Dynamics/Coagulation/Functional/Coagulation_Basic_1_PMF.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Coagulation Basic 1: PMF Representation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Coagulation Basic 1: PMF Representation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direct-implementation-for-discrete-particle-size-distributions">Direct Implementation for Discrete Particle Size Distributions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#objective">Objective</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#approach">Approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#required-libraries">Required Libraries</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-size-distribution">Creating a Size Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#particle-size-bins">Particle Size Bins</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#particle-mass-calculation">Particle Mass Calculation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-brownian-coagulation-kernel">Calculating the Brownian Coagulation Kernel</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-calculation">Kernel Calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzing-the-kernel">Analyzing the Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-dataframe">Creating a DataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-saving-the-kernel-matrix">Optional: Saving the Kernel Matrix</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-brownian-coagulation-kernel">Plotting the Brownian Coagulation Kernel</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-setup">Visualization Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#axes-configuration">Axes Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-y-axis-logarithmic-scale">Optional Y-axis Logarithmic Scale</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-particle-concentrations">Adding Particle Concentrations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-concentration-setup">Initial Concentration Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-the-initial-concentration">Visualization of the Initial Concentration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importance-of-concentration">Importance of Concentration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coagulation-rate-calculation">Coagulation Rate Calculation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gain-loss-and-net-rate-calculation">Gain, Loss, and Net Rate Calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#displaying-results">Displaying Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-coagulation-gain-loss-and-net-rates">Plotting the Coagulation Gain, Loss, and Net Rates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-details">Plot Details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Axes Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation">Interpretation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-the-coagulation-process-over-time">Simulating the Coagulation Process Over Time</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-setup">Simulation Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-step-1">Time Step 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-step-2">Time Step 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-step-3">Time Step 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observing-changes">Observing Changes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-creation">DataFrame Creation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-saving-results">Optional: Saving Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Interpretation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-evolution-of-particle-concentration">Plotting the Evolution of Particle Concentration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Plot Details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Axes Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Interpretation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#end-member-error">End member Error</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lognormal-distribution">Lognormal Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-lognormal-distribution">Why Lognormal Distribution?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-radius-and-mass-bins">Defining the Radius and Mass Bins</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-the-lognormal-distribution">Generating the Lognormal Distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-lognormal-distribution">Plotting the Lognormal Distribution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-the-coagulation-process-for-a-lognormal-distribution">Simulating the Coagulation Process for a Lognormal Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Simulation Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-step-calculations">Time Step Calculations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-results">Combining Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Optional: Saving Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Interpretation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzing-concentration-extremes-over-time">Analyzing Concentration Extremes Over Time</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#concentration-extremes">Concentration Extremes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Interpretation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-coagulation-gain-loss-and-net-rates-for-lognormal-distribution">Plotting the Coagulation Gain, Loss, and Net Rates for Lognormal Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Plot Details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Axes Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#legend-and-interpretation">Legend and Interpretation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-evolution-of-concentration-for-lognormal-distribution">Plotting the Evolution of Concentration for Lognormal Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Plot Details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Axes Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Interpretation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#total-concentration-over-time">Total Concentration Over Time</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-steps-and-findings">Key Steps and Findings:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion:</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="coagulation-basic-1-pmf-representation">
<h1>Coagulation Basic 1: PMF Representation<a class="headerlink" href="#coagulation-basic-1-pmf-representation" title="Link to this heading">#</a></h1>
<section id="direct-implementation-for-discrete-particle-size-distributions">
<h2>Direct Implementation for Discrete Particle Size Distributions<a class="headerlink" href="#direct-implementation-for-discrete-particle-size-distributions" title="Link to this heading">#</a></h2>
<p>In this section, we present a direct implementation of the coagulation process based on the methodology outlined in Seinfeld and Pandis (2006). This notebook is designed to provide a clear understanding of the fundamental code required to simulate particle coagulation, without the abstraction layers provided by more advanced object-oriented approaches.</p>
<section id="objective">
<h3>Objective<a class="headerlink" href="#objective" title="Link to this heading">#</a></h3>
<p>The primary goal is to demonstrate how to calculate the coagulation kernel and the resulting coagulation rates for a given particle size distribution. We will start with a uniform size bin and distribution to establish the basic principles. Then, we will extend this to a more realistic lognormal distribution, which is commonly observed in aerosol science.</p>
</section>
<section id="approach">
<h3>Approach<a class="headerlink" href="#approach" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Uniform Distribution</strong>: We first initialize a simple, uniform particle size distribution. This helps in understanding the basic coagulation mechanics.</p></li>
<li><p><strong>Lognormal Probability Mass Function</strong>: After establishing the basics, we move on to a lognormal size distribution, which better represents real-world aerosol size distributions. Probability mass functions (PMFs) is a bin representation of the lognormal distribution, so the sum of all bins equals total concentration.</p></li>
</ul>
<p>This step-by-step approach will provide a foundation for understanding more complex implementations, such as those available in the <code class="docutils literal notranslate"><span class="pre">particula</span></code> library.</p>
</section>
<section id="required-libraries">
<h3>Required Libraries<a class="headerlink" href="#required-libraries" title="Link to this heading">#</a></h3>
<p>We will utilize standard scientific libraries such as <code class="docutils literal notranslate"><span class="pre">numpy</span></code> for numerical computations, <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> for plotting, and <code class="docutils literal notranslate"><span class="pre">pandas</span></code> for data handling. Additionally, we import specific functions from the <code class="docutils literal notranslate"><span class="pre">particula</span></code> library to calculate the coagulation kernel and generate size distributions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># particula imports</span>
<span class="kn">from</span> <span class="nn">particula.next.dynamics.coagulation</span> <span class="kn">import</span> <span class="n">brownian_kernel</span><span class="p">,</span> <span class="n">rate</span>
<span class="kn">from</span> <span class="nn">particula.next.particles.properties.lognormal_size_distribution</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">lognormal_pmf_distribution</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># The `brownian_kernel` function calculates the Brownian coagulation kernel,</span>
<span class="c1"># which determines the rate at which particles coagulate due to random motion.</span>
<span class="c1"># The `rate` function computes the rate of change in particle concentration</span>
<span class="c1"># due to the coagulation process.</span>
<span class="c1"># The `lognormal_pmf_distribution` function generates a probability mass function</span>
<span class="c1"># based on a lognormal size distribution, commonly used to represent aerosol particles.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># particula imports</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">particula.next.dynamics.coagulation</span> <span class="kn">import</span> <span class="n">brownian_kernel</span><span class="p">,</span> <span class="n">rate</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">from</span> <span class="nn">particula.next.particles.properties.lognormal_size_distribution</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">lognormal_pmf_distribution</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="c1"># The `brownian_kernel` function calculates the Brownian coagulation kernel,</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="c1"># which determines the rate at which particles coagulate due to random motion.</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="c1"># The `rate` function computes the rate of change in particle concentration</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1"># due to the coagulation process.</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="c1"># The `lognormal_pmf_distribution` function generates a probability mass function</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="c1"># based on a lognormal size distribution, commonly used to represent aerosol particles.</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.11.10</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">particula</span><span class="o">/</span><span class="nb">next</span><span class="o">/</span><span class="n">dynamics</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">14</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Condensation dynamics exposed via __init__.</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span><span class="sd"> </span>
<span class="g g-Whitespace">      </span><span class="mi">3</span><span class="sd"> If you want specific sub functions, import them directly from</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span><span class="sd"> `particula.next.dynamics.condensation.xxx.xxx` instead.</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="c1"># later: pytype does not like these imports.</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> 
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="c1"># pylint: disable=unused-import, disable=line-too-long</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># flake8: noqa</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="c1"># pyright: basic</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="c1"># pytype: skip-file</span>
<span class="ne">---&gt; </span><span class="mi">14</span> <span class="kn">from</span> <span class="nn">particula.next.dynamics</span> <span class="kn">import</span> <span class="n">condensation</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="kn">from</span> <span class="nn">particula.next.dynamics</span> <span class="kn">import</span> <span class="n">coagulation</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="kn">from</span> <span class="nn">particula.next.dynamics</span> <span class="kn">import</span> <span class="n">properties</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.11.10</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">particula</span><span class="o">/</span><span class="nb">next</span><span class="o">/</span><span class="n">dynamics</span><span class="o">/</span><span class="n">condensation</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">14</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Condensation dynamics exposed via __init__.</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span><span class="sd"> </span>
<span class="g g-Whitespace">      </span><span class="mi">3</span><span class="sd"> If you want specific sub functions, import them directly from</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span><span class="sd"> `particula.next.dynamics.condensation.xxx.xxx` instead.</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="c1"># later: pytype does not like these imports.</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> 
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="c1"># pylint: disable=unused-import, disable=line-too-long</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># flake8: noqa</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="c1"># pyright: basic</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="c1"># pytype: skip-file</span>
<span class="ne">---&gt; </span><span class="mi">14</span> <span class="kn">from</span> <span class="nn">particula.next.dynamics.condensation.condensation_strategies</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">CondensationIsothermal</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="kn">from</span> <span class="nn">particula.next.dynamics.condensation.mass_transfer</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="n">mass_transfer_rate</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">first_order_mass_transport_k</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="n">radius_transfer_rate</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">calculate_mass_transfer</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="p">)</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.11.10</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">particula</span><span class="o">/</span><span class="nb">next</span><span class="o">/</span><span class="n">dynamics</span><span class="o">/</span><span class="n">condensation</span><span class="o">/</span><span class="n">condensation_strategies</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">44</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span> <span class="c1"># particula imports</span>
<span class="ne">---&gt; </span><span class="mi">44</span> <span class="kn">from</span> <span class="nn">particula.next.particles.representation</span> <span class="kn">import</span> <span class="n">ParticleRepresentation</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span> <span class="kn">from</span> <span class="nn">particula.next.gas.species</span> <span class="kn">import</span> <span class="n">GasSpecies</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="kn">from</span> <span class="nn">particula.next.particles.properties</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span>     <span class="n">calculate_knudsen_number</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>     <span class="n">vapor_transition_correction</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span>     <span class="n">partial_pressure_delta</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span> <span class="p">)</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.11.10</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">particula</span><span class="o">/</span><span class="nb">next</span><span class="o">/</span><span class="n">particles</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">22</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">particula.next.particles.distribution_strategies</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">MassBasedMovingBin</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="n">RadiiBasedMovingBin</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">SpeciatedMassMovingBin</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">ParticleResolvedSpeciatedMass</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="kn">from</span> <span class="nn">particula.next.particles.distribution_builders</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">MassBasedMovingBinBuilder</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="n">RadiiBasedMovingBinBuilder</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">SpeciatedMassMovingBinBuilder</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="n">ParticleResolvedSpeciatedMassBuilder</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">22</span> <span class="kn">from</span> <span class="nn">particula.next.particles.distribution_factories</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>     <span class="n">DistributionFactory</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="kn">from</span> <span class="nn">particula.next.particles.activity_strategies</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>     <span class="n">ActivityIdealMass</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span>     <span class="n">ActivityIdealMolar</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>     <span class="n">ActivityKappaParameter</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="kn">from</span> <span class="nn">particula.next.particles.activity_builders</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span>     <span class="n">ActivityIdealMassBuilder</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span>     <span class="n">ActivityIdealMolarBuilder</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span>     <span class="n">ActivityKappaParameterBuilder</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="p">)</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">hostedtoolcache</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="mf">3.11.10</span><span class="o">/</span><span class="n">x64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">particula</span><span class="o">/</span><span class="nb">next</span><span class="o">/</span><span class="n">particles</span><span class="o">/</span><span class="n">distribution_factories</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">5</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Factory Classes for selecting the distribution strategy.</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="kn">from</span> <span class="nn">particula.next.abc_factory</span> <span class="kn">import</span> <span class="n">StrategyFactory</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">particula.next.particles.distribution_strategies</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">MassBasedMovingBin</span><span class="p">,</span> <span class="n">RadiiBasedMovingBin</span><span class="p">,</span> <span class="n">SpeciatedMassMovingBin</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">ParticleResolvedSpeciatedMass</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">particula.next.particles.distribution_builders</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">MassBasedMovingBinBuilder</span><span class="p">,</span> <span class="n">RadiiBasedMovingBinBuilder</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="n">SpeciatedMassMovingBinBuilder</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">ParticleResolvedSpeciatedMassBuilder</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;particula.next.abc_factory&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="creating-a-size-distribution">
<h2>Creating a Size Distribution<a class="headerlink" href="#creating-a-size-distribution" title="Link to this heading">#</a></h2>
<p>In this section, we define the size distribution for aerosol particles. The particle sizes are distributed across several bins, allowing us to model the behavior of particles across a wide size range.</p>
<section id="particle-size-bins">
<h3>Particle Size Bins<a class="headerlink" href="#particle-size-bins" title="Link to this heading">#</a></h3>
<p>We first define the bins for particle radii using a logarithmic scale. The logarithmic scale (<code class="docutils literal notranslate"><span class="pre">np.logspace</span></code>) is particularly useful when dealing with aerosol particles because their sizes often span several orders of magnitude—from nanometers to micrometers. This approach ensures that we capture the full range of particle sizes with more granularity where it matters.</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">radius_bins</span></code></strong>: These bins represent the particle radii, ranging from 1 nanometer (1e-9 m) to 10 micrometers (1e-5 m).</p></li>
</ul>
</section>
<section id="particle-mass-calculation">
<h3>Particle Mass Calculation<a class="headerlink" href="#particle-mass-calculation" title="Link to this heading">#</a></h3>
<p>Next, we calculate the mass of particles in each size bin. The mass is determined using the formula for the volume of a sphere (<code class="docutils literal notranslate"><span class="pre">4/3</span> <span class="pre">*</span> <span class="pre">π</span> <span class="pre">*</span> <span class="pre">r^3</span></code>), assuming a uniform particle density of 1 g/cm³ (which corresponds to 1000 kg/m³ in SI units).</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">mass_bins</span></code></strong>: The resulting array contains the masses of particles corresponding to each size bin, which is a key parameter for understanding how these particles will interact and coagulate.</p></li>
</ul>
<p>This setup provides a foundation for further analysis of the coagulation process by linking particle size and mass, essential components in determining coagulation rates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a size distribution for aerosol particles</span>

<span class="c1"># Define the bins for particle radius using a logarithmic scale</span>
<span class="n">radius_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mi">9</span><span class="p">,</span> <span class="n">stop</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># m (1 nm to 10 μm)</span>

<span class="c1"># Calculate the mass of particles for each size bin</span>
<span class="c1"># The mass is calculated using the formula for the volume of a sphere (4/3 * π * r^3)</span>
<span class="c1"># and assuming a particle density of 1 g/cm^3 (which is 1000 kg/m^3 in SI units).</span>
<span class="n">mass_bins</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius_bins</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="mf">1e3</span>  <span class="c1"># kg</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="calculating-the-brownian-coagulation-kernel">
<h2>Calculating the Brownian Coagulation Kernel<a class="headerlink" href="#calculating-the-brownian-coagulation-kernel" title="Link to this heading">#</a></h2>
<p>In this section, we calculate the Brownian coagulation kernel matrix, which quantifies the rate at which particles of different sizes collide and coagulate due to Brownian motion. The kernel matrix is central to understanding the dynamics of particle coagulation.</p>
<section id="kernel-calculation">
<h3>Kernel Calculation<a class="headerlink" href="#kernel-calculation" title="Link to this heading">#</a></h3>
<p>We use the <code class="docutils literal notranslate"><span class="pre">brownian_coagulation_kernel_via_system_state</span></code> function from the <code class="docutils literal notranslate"><span class="pre">particula</span></code> library to compute the kernel matrix. This function requires the following inputs:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">radius_particle</span></code></strong>: The array of particle radii, which we previously defined in <code class="docutils literal notranslate"><span class="pre">radius_bins</span></code>.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">mass_particle</span></code></strong>: The corresponding array of particle masses from <code class="docutils literal notranslate"><span class="pre">mass_bins</span></code>.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">temperature</span></code></strong>: The ambient temperature, set here to 293.15 K (equivalent to 20°C).</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">pressure</span></code></strong>: The ambient pressure, set to 101325 Pa (standard atmospheric pressure).</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">alpha_collision_efficiency</span></code></strong>: A dimensionless factor representing the efficiency of particle collisions, assumed to be 1.0 for perfect efficiency.</p></li>
</ul>
<p>The output is a matrix (kernel) where each element represents the coagulation rate between two specific particle sizes.</p>
</section>
<section id="analyzing-the-kernel">
<h3>Analyzing the Kernel<a class="headerlink" href="#analyzing-the-kernel" title="Link to this heading">#</a></h3>
<p>We print the shape of the kernel matrix to verify its dimensions, which should match the number of radius bins (i.e., it will be a square matrix).</p>
</section>
<section id="creating-a-dataframe">
<h3>Creating a DataFrame<a class="headerlink" href="#creating-a-dataframe" title="Link to this heading">#</a></h3>
<p>To facilitate analysis, we convert the kernel matrix into a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame. The DataFrame format allows for easy manipulation and visualization of the data. The rows and columns of the DataFrame are indexed by the particle radii, making it straightforward to identify which particle sizes are interacting.</p>
<p>We then print the first five rows of the DataFrame to inspect the calculated values. This provides a quick glimpse into the interaction rates between the smallest particles.</p>
</section>
<section id="optional-saving-the-kernel-matrix">
<h3>Optional: Saving the Kernel Matrix<a class="headerlink" href="#optional-saving-the-kernel-matrix" title="Link to this heading">#</a></h3>
<p>For further analysis or to share with others, the kernel matrix can be saved as a CSV file. This step is optional but useful if you need to persist the results for future work.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the Brownian coagulation kernel matrix</span>

<span class="c1"># The Brownian coagulation kernel is calculated using the `brownian_coagulation_kernel_via_system_state` function.</span>
<span class="c1"># This function takes into account the particle size, mass, temperature, pressure, and collision efficiency</span>
<span class="c1"># to compute the coagulation rates between particles of different sizes.</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">brownian_kernel</span><span class="o">.</span><span class="n">brownian_coagulation_kernel_via_system_state</span><span class="p">(</span>
    <span class="n">radius_particle</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">,</span>
    <span class="n">mass_particle</span><span class="o">=</span><span class="n">mass_bins</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">293.15</span><span class="p">,</span>  <span class="c1"># Temperature in Kelvin (20°C)</span>
    <span class="n">pressure</span><span class="o">=</span><span class="mi">101325</span><span class="p">,</span>  <span class="c1"># Pressure in Pascals (1 atm)</span>
    <span class="n">alpha_collision_efficiency</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Assume perfect collision efficiency</span>
<span class="p">)</span>

<span class="c1"># Display the shape of the kernel matrix to confirm its dimensions</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kernel shape: </span><span class="si">{</span><span class="n">kernel</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create a pandas DataFrame from the kernel matrix</span>
<span class="c1"># The DataFrame allows for easier analysis and visualization of the coagulation kernel.</span>
<span class="c1"># Rows and columns are indexed by the particle radius bins, making it clear which sizes are interacting.</span>
<span class="n">df_kernel</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">)</span>

<span class="c1"># Print the first 5 rows of the DataFrame to inspect the computed kernel values</span>
<span class="n">df_kernel</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Optional: Save the kernel matrix to a CSV file for further analysis or sharing</span>
<span class="c1"># df_kernel.to_csv(&quot;kernel.csv&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Kernel shape: (10, 10)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1.000000e-09</th>
      <th>2.782559e-09</th>
      <th>7.742637e-09</th>
      <th>2.154435e-08</th>
      <th>5.994843e-08</th>
      <th>1.668101e-07</th>
      <th>4.641589e-07</th>
      <th>1.291550e-06</th>
      <th>3.593814e-06</th>
      <th>1.000000e-05</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.000000e-09</th>
      <td>8.812734e-16</td>
      <td>2.277171e-15</td>
      <td>1.181152e-14</td>
      <td>7.503580e-14</td>
      <td>4.506909e-13</td>
      <td>2.024284e-12</td>
      <td>6.824175e-12</td>
      <td>2.020759e-11</td>
      <td>5.737860e-11</td>
      <td>1.607645e-10</td>
    </tr>
    <tr>
      <th>2.782559e-09</th>
      <td>2.277171e-15</td>
      <td>1.461722e-15</td>
      <td>3.692369e-15</td>
      <td>1.733024e-14</td>
      <td>8.141373e-14</td>
      <td>3.005388e-13</td>
      <td>9.275265e-13</td>
      <td>2.670597e-12</td>
      <td>7.517319e-12</td>
      <td>2.100038e-11</td>
    </tr>
    <tr>
      <th>7.742637e-09</th>
      <td>1.181152e-14</td>
      <td>3.692369e-15</td>
      <td>2.224511e-15</td>
      <td>4.558035e-15</td>
      <td>1.429060e-14</td>
      <td>4.375392e-14</td>
      <td>1.267816e-13</td>
      <td>3.580220e-13</td>
      <td>1.001331e-12</td>
      <td>2.790647e-12</td>
    </tr>
    <tr>
      <th>2.154435e-08</th>
      <td>7.503580e-14</td>
      <td>1.733024e-14</td>
      <td>4.558035e-15</td>
      <td>2.123764e-15</td>
      <td>3.008409e-15</td>
      <td>7.020882e-15</td>
      <td>1.858550e-14</td>
      <td>5.087944e-14</td>
      <td>1.407135e-13</td>
      <td>3.904922e-13</td>
    </tr>
    <tr>
      <th>5.994843e-08</th>
      <td>4.506909e-13</td>
      <td>8.141373e-14</td>
      <td>1.429060e-14</td>
      <td>3.008409e-15</td>
      <td>1.304527e-15</td>
      <td>1.624475e-15</td>
      <td>3.413800e-15</td>
      <td>8.588241e-15</td>
      <td>2.303139e-14</td>
      <td>6.320152e-14</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="plotting-the-brownian-coagulation-kernel">
<h2>Plotting the Brownian Coagulation Kernel<a class="headerlink" href="#plotting-the-brownian-coagulation-kernel" title="Link to this heading">#</a></h2>
<p>After calculating the Brownian coagulation kernel, the next step is to visualize the results. A plot of the kernel values against the particle radius provides insights into how the coagulation rates vary with particle size.</p>
<section id="visualization-setup">
<h3>Visualization Setup<a class="headerlink" href="#visualization-setup" title="Link to this heading">#</a></h3>
<p>We use <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> to create the plot:</p>
<ul class="simple">
<li><p><strong>Figure and Axis</strong>: We begin by creating a figure and an axis object using <code class="docutils literal notranslate"><span class="pre">plt.subplots()</span></code>, which provides a flexible framework for plotting.</p></li>
<li><p><strong>Kernel Plot</strong>: The kernel values are plotted on the y-axis, and the particle radii on the x-axis. Since the kernel values can span several orders of magnitude, we plot their logarithm (base 10) to better visualize the data.</p></li>
</ul>
</section>
<section id="axes-configuration">
<h3>Axes Configuration<a class="headerlink" href="#axes-configuration" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>X-axis</strong>: The x-axis represents the particle radius in meters. Given the wide range of particle sizes, we use a logarithmic scale (<code class="docutils literal notranslate"><span class="pre">set_xscale(&quot;log&quot;)</span></code>) to evenly distribute the data across the axis.</p></li>
<li><p><strong>Y-axis</strong>: The y-axis represents the logarithm of the kernel values (<code class="docutils literal notranslate"><span class="pre">Log10(Kernel)</span></code>). This choice makes it easier to observe trends and differences in the coagulation rates across different particle sizes.</p></li>
</ul>
</section>
<section id="optional-y-axis-logarithmic-scale">
<h3>Optional Y-axis Logarithmic Scale<a class="headerlink" href="#optional-y-axis-logarithmic-scale" title="Link to this heading">#</a></h3>
<p>If a deeper examination of the kernel’s range is required, the y-axis can also be set to a logarithmic scale by uncommenting the <code class="docutils literal notranslate"><span class="pre">ax.set_yscale(&quot;log&quot;)</span></code> line. This is useful when the kernel values span several orders of magnitude and need to be visualized more clearly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the Brownian coagulation kernel</span>

<span class="c1"># Create a figure and axis object using matplotlib</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the kernel values against the particle radius bins</span>
<span class="c1"># The kernel values are plotted on a logarithmic scale (log10) for better visualization.</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">kernel</span><span class="p">))</span>

<span class="c1"># Set the x-axis label to indicate the particle radius in meters</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Particle radius (m)&quot;</span><span class="p">)</span>

<span class="c1"># Set the y-axis label to indicate the logarithm of the kernel values</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Log10(Kernel)&quot;</span><span class="p">)</span>

<span class="c1"># Use a logarithmic scale for the x-axis to properly represent the wide range of particle sizes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="c1"># Optionally, the y-axis can also be set to a logarithmic scale if needed</span>
<span class="c1"># ax.set_yscale(&quot;log&quot;)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/da5093aa7fdfe00b200362e65ed2e7d3a65c71218cc9412cf8c7f8dfd994e5e6.png" src="../../../../_images/da5093aa7fdfe00b200362e65ed2e7d3a65c71218cc9412cf8c7f8dfd994e5e6.png" />
</div>
</div>
</section>
</section>
<section id="adding-particle-concentrations">
<h2>Adding Particle Concentrations<a class="headerlink" href="#adding-particle-concentrations" title="Link to this heading">#</a></h2>
<p>Now that we have calculated the Brownian coagulation kernel, the next step is to introduce the particle concentrations. While the coagulation kernel itself does not depend on the particle concentration, the concentrations are critical when calculating the actual rate of coagulation, as they determine how many particles are available to interact.</p>
<section id="initial-concentration-setup">
<h3>Initial Concentration Setup<a class="headerlink" href="#initial-concentration-setup" title="Link to this heading">#</a></h3>
<p>We define an initial particle concentration for each size bin:</p>
<ul class="simple">
<li><p><strong>Uniform Concentration</strong>: In this example, we set a uniform concentration across all size bins. Specifically, we assign a concentration of 100 particles per cubic centimeter (100 cm^-3), which converts to 100 million particles per cubic meter (100 * 1e6 m^-3). This concentration is representative of a typical ambient particle concentration in the atmosphere.</p></li>
</ul>
</section>
<section id="visualization-of-the-initial-concentration">
<h3>Visualization of the Initial Concentration<a class="headerlink" href="#visualization-of-the-initial-concentration" title="Link to this heading">#</a></h3>
<p>To better understand the initial distribution of particle concentrations, we plot these values against the particle radius:</p>
<ul class="simple">
<li><p><strong>X-axis</strong>: The x-axis represents the particle radius in meters, using a logarithmic scale to cover the wide range of particle sizes.</p></li>
<li><p><strong>Y-axis</strong>: The y-axis shows the particle concentration in particles per cubic meter (m^-3), also plotted on a logarithmic scale. The logarithmic scales on both axes allow us to clearly see the distribution across several orders of magnitude, which is common in aerosol science.</p></li>
</ul>
</section>
<section id="importance-of-concentration">
<h3>Importance of Concentration<a class="headerlink" href="#importance-of-concentration" title="Link to this heading">#</a></h3>
<p>While the kernel function determines the rate at which particles of different sizes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the initial particle concentration</span>

<span class="c1"># Set the initial concentration for each size bin</span>
<span class="c1"># The concentration is set uniformly across all bins at 100 particles per cubic centimeter (100 cm^-3),</span>
<span class="c1"># which is equivalent to 100 * 1e6 particles per cubic meter (m^-3).</span>
<span class="n">concentration_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># m^-3</span>

<span class="c1"># Plot the initial concentration distribution</span>

<span class="c1"># Create a figure and axis object for the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the concentration against the particle radius</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_0</span><span class="p">)</span>

<span class="c1"># Set the x-axis label to indicate the particle radius in meters</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Particle radius (m)&quot;</span><span class="p">)</span>

<span class="c1"># Set the y-axis label to indicate the concentration in particles per cubic meter</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Concentration (m^-3)&quot;</span><span class="p">)</span>

<span class="c1"># Use a logarithmic scale for both the x-axis and y-axis</span>
<span class="c1"># This is because the concentration distribution is typically viewed across several orders of magnitude</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/27b43893e2ec045a888f99f41ce5a8737b0f2779e97872b6aca486ddb86c28f3.png" src="../../../../_images/27b43893e2ec045a888f99f41ce5a8737b0f2779e97872b6aca486ddb86c28f3.png" />
</div>
</div>
</section>
</section>
<section id="coagulation-rate-calculation">
<h2>Coagulation Rate Calculation<a class="headerlink" href="#coagulation-rate-calculation" title="Link to this heading">#</a></h2>
<p>With the coagulation kernel and initial concentrations defined, we can now calculate the rates at which particles are gained, lost, and the net change due to coagulation. These rates are essential for understanding how the particle size distribution evolves over time as particles collide and coagulate.</p>
<section id="gain-loss-and-net-rate-calculation">
<h3>Gain, Loss, and Net Rate Calculation<a class="headerlink" href="#gain-loss-and-net-rate-calculation" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Gain (<code class="docutils literal notranslate"><span class="pre">discrete_gain</span></code>)</strong>: This function calculates the rate at which particles are gained in each size bin due to coagulation. Gain occurs when two smaller particles collide to form a larger particle, increasing the concentration in the corresponding size bin.</p></li>
<li><p><strong>Loss (<code class="docutils literal notranslate"><span class="pre">discrete_loss</span></code>)</strong>: This function calculates the rate at which particles are lost from each size bin due to coagulation. Loss happens when particles in a particular size bin collide with other particles, thereby decreasing the concentration in that bin.</p></li>
<li><p><strong>Net Rate</strong>: The net rate is the difference between the gain and loss for each size bin (<code class="docutils literal notranslate"><span class="pre">net_0</span> <span class="pre">=</span> <span class="pre">gain_0</span> <span class="pre">-</span> <span class="pre">loss_0</span></code>). It represents the overall change in concentration for each particle size due to coagulation.</p></li>
</ul>
</section>
<section id="displaying-results">
<h3>Displaying Results<a class="headerlink" href="#displaying-results" title="Link to this heading">#</a></h3>
<p>We create a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame to organize and display the gain, loss, and net coagulation rates for each particle size bin. The DataFrame is indexed by particle radius, which makes it easy to understand the changes in concentration across different sizes.</p>
<ul class="simple">
<li><p><strong>Gain</strong>: The rate at which particles are added to each bin due to coagulation.</p></li>
<li><p><strong>Loss</strong>: The rate at which particles are removed from each bin due to coagulation.</p></li>
<li><p><strong>Net</strong>: The overall change in concentration for each bin.</p></li>
</ul>
<p>Finally, we display the first five rows of the DataFrame to inspect the initial values for gain, loss, and net change. This provides a quick look at how coagulation is expected to alter the particle size distribution in the system.</p>
<p>By analyzing these rates, we can predict the dynamic behavior of the aerosol particles over time, as smaller particles merge to form larger ones or disappear from the system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Coagulation rate calculation</span>

<span class="c1"># Calculate the gain, loss, and net change in particle concentration due to coagulation</span>
<span class="c1"># `discrete_gain`: Calculates the rate at which particles are gained due to coagulation</span>
<span class="c1"># `discrete_loss`: Calculates the rate at which particles are lost due to coagulation</span>
<span class="n">gain_0</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_gain</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_0</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">loss_0</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_loss</span><span class="p">(</span><span class="n">concentration_0</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">net_0</span> <span class="o">=</span> <span class="n">gain_0</span> <span class="o">-</span> <span class="n">loss_0</span>  <span class="c1"># Net change in concentration</span>

<span class="c1"># Create a DataFrame to display the gain, loss, and net coagulation rates</span>
<span class="c1"># The DataFrame is indexed by particle radius bins for clarity</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Gain&quot;</span><span class="p">:</span> <span class="n">gain_0</span><span class="p">,</span> <span class="s2">&quot;Loss&quot;</span><span class="p">:</span> <span class="n">loss_0</span><span class="p">,</span> <span class="s2">&quot;Net&quot;</span><span class="p">:</span> <span class="n">net_0</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">radius_bins</span>
<span class="p">)</span>

<span class="c1"># Display the first 5 rows of the DataFrame</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gain</th>
      <th>Loss</th>
      <th>Net</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.000000e-09</th>
      <td>4.379653</td>
      <td>2.477398e+06</td>
      <td>-2.477394e+06</td>
    </tr>
    <tr>
      <th>2.782559e-09</th>
      <td>25.830601</td>
      <td>3.252254e+05</td>
      <td>-3.251995e+05</td>
    </tr>
    <tr>
      <th>7.742637e-09</th>
      <td>79.877700</td>
      <td>4.357112e+04</td>
      <td>-4.349124e+04</td>
    </tr>
    <tr>
      <th>2.154435e-08</th>
      <td>1666.815122</td>
      <td>7.097477e+03</td>
      <td>-5.430662e+03</td>
    </tr>
    <tr>
      <th>5.994843e-08</th>
      <td>-12799.281898</td>
      <td>6.505676e+03</td>
      <td>-1.930496e+04</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="plotting-the-coagulation-gain-loss-and-net-rates">
<h2>Plotting the Coagulation Gain, Loss, and Net Rates<a class="headerlink" href="#plotting-the-coagulation-gain-loss-and-net-rates" title="Link to this heading">#</a></h2>
<p>After calculating the coagulation rates, it’s crucial to visualize how these rates vary across different particle sizes. This plot will show the gain, loss, and net rates of particle concentration as a function of particle radius.</p>
<section id="plot-details">
<h3>Plot Details<a class="headerlink" href="#plot-details" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Net Rate</strong>: The net rate of change in particle concentration is plotted as a thick gray line. This line highlights the overall effect of coagulation, showing whether the concentration in each size bin is increasing or decreasing.</p></li>
<li><p><strong>Gain Rate</strong>: The gain rate is plotted in dark green. This line shows how particles are being added to each size bin as smaller particles coagulate to form larger ones.</p></li>
<li><p><strong>Loss Rate</strong>: The loss rate is plotted in red. To make it visually distinct and indicate that it’s a removal process, the loss rate is plotted as <code class="docutils literal notranslate"><span class="pre">-1</span> <span class="pre">*</span> <span class="pre">loss_0</span></code>. This negative value reflects the decrease in particle concentration due to coagulation.</p></li>
</ul>
</section>
<section id="id1">
<h3>Axes Configuration<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>X-axis</strong>: The x-axis represents the particle radius in meters, plotted on a logarithmic scale. This scale is essential for accurately representing the wide range of particle sizes, from nanometers to micrometers.</p></li>
<li><p><strong>Y-axis</strong>: The y-axis shows the rate of change in concentration, with units of <code class="docutils literal notranslate"><span class="pre">m⁻³</span> <span class="pre">s⁻¹</span></code>, indicating how quickly particles are being gained, lost, or changing net concentration in the system.</p></li>
</ul>
</section>
<section id="interpretation">
<h3>Interpretation<a class="headerlink" href="#interpretation" title="Link to this heading">#</a></h3>
<p>By analyzing this plot, you can determine which particle sizes are most affected by coagulation. For instance, sizes where the net rate is positive indicate that coagulation is leading to an increase in concentration, while negative values suggest a decrease. This visualization is crucial for understanding the evolution of the particle size distribution over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the coagulation gain, loss, and net rates</span>

<span class="c1"># Create a figure and axis object for the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the net coagulation rate</span>
<span class="c1"># The net rate is plotted with a thicker gray line for emphasis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">net_0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Net&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Plot the gain rate</span>
<span class="c1"># The gain rate is plotted in dark green</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">gain_0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gain&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">)</span>

<span class="c1"># Plot the loss rate</span>
<span class="c1"># The loss rate is plotted in red, and multiplied by -1 for plotting to indicate that it&#39;s a removal process</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">loss_0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Loss&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

<span class="c1"># Set the x-axis label to indicate the particle radius in meters</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Particle radius (m)&quot;</span><span class="p">)</span>

<span class="c1"># Set the y-axis label to indicate the rate of change in concentration, with appropriate units</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Rate $\dfrac</span><span class="si">{1}</span><span class="s2">{m^</span><span class="si">{3}</span><span class="s2"> s^</span><span class="si">{1}</span><span class="s2">}$&quot;</span><span class="p">)</span>

<span class="c1"># Use a logarithmic scale for the x-axis to account for the wide range of particle sizes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="c1"># Add a legend to the plot to identify the gain, loss, and net lines</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/ea5c9229e089c13b481a3b9bab00917aee52c1ba804fbe4d87dfedb1ad2b7239.png" src="../../../../_images/ea5c9229e089c13b481a3b9bab00917aee52c1ba804fbe4d87dfedb1ad2b7239.png" />
</div>
</div>
</section>
</section>
<section id="simulating-the-coagulation-process-over-time">
<h2>Simulating the Coagulation Process Over Time<a class="headerlink" href="#simulating-the-coagulation-process-over-time" title="Link to this heading">#</a></h2>
<p>In this section, we manually simulate the coagulation process over a few discrete time steps. This manual simulation allows us to observe how particle concentrations evolve as a result of coagulation.</p>
<section id="simulation-setup">
<h3>Simulation Setup<a class="headerlink" href="#simulation-setup" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Time Step</strong>: We define a time step of 0.1 seconds (<code class="docutils literal notranslate"><span class="pre">TIME_STEP</span> <span class="pre">=</span> <span class="pre">0.1</span></code>). This value represents the interval at which we update the particle concentrations based on the coagulation rates.</p></li>
</ul>
</section>
<section id="time-step-1">
<h3>Time Step 1<a class="headerlink" href="#time-step-1" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Calculate Gain and Loss</strong>: Using the initial concentration (<code class="docutils literal notranslate"><span class="pre">concentration_0</span></code>), we calculate the gain and loss rates using the coagulation kernel.</p></li>
<li><p><strong>Net Rate</strong>: The net rate of change in concentration is determined by subtracting the loss from the gain.</p></li>
<li><p><strong>Update Concentration</strong>: The concentration is updated by adding the net rate multiplied by the time step to the initial concentration, resulting in <code class="docutils literal notranslate"><span class="pre">concentration_1</span></code>.</p></li>
</ol>
</section>
<section id="time-step-2">
<h3>Time Step 2<a class="headerlink" href="#time-step-2" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Recalculate Gain and Loss</strong>: With the updated concentration from time step 1 (<code class="docutils literal notranslate"><span class="pre">concentration_1</span></code>), we recalculate the gain and loss rates.</p></li>
<li><p><strong>Net Rate</strong>: Again, we calculate the net rate of change.</p></li>
<li><p><strong>Update Concentration</strong>: The concentration is updated to <code class="docutils literal notranslate"><span class="pre">concentration_2</span></code> using the same method as in time step 1.</p></li>
</ol>
</section>
<section id="time-step-3">
<h3>Time Step 3<a class="headerlink" href="#time-step-3" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Recalculate Gain and Loss</strong>: We perform the same calculations with the concentration from time step 2 (<code class="docutils literal notranslate"><span class="pre">concentration_2</span></code>).</p></li>
<li><p><strong>Update Concentration</strong>: The concentration is updated to <code class="docutils literal notranslate"><span class="pre">concentration_3</span></code>.</p></li>
</ol>
</section>
<section id="observing-changes">
<h3>Observing Changes<a class="headerlink" href="#observing-changes" title="Link to this heading">#</a></h3>
<p>We print the maximum concentration at each time step to observe how the distribution evolves due to coagulation. This can provide insights into how quickly particles are coalescing into larger sizes or being depleted.</p>
</section>
<section id="dataframe-creation">
<h3>DataFrame Creation<a class="headerlink" href="#dataframe-creation" title="Link to this heading">#</a></h3>
<p>The concentrations at each time step are combined into a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame, making it easier to compare how the distribution changes over time. We display the first few rows to inspect these changes.</p>
</section>
<section id="optional-saving-results">
<h3>Optional: Saving Results<a class="headerlink" href="#optional-saving-results" title="Link to this heading">#</a></h3>
<p>The concentration data can be saved to a CSV file for further analysis or visualization, allowing you to track the evolution of particle concentrations over time.</p>
</section>
<section id="id2">
<h3>Interpretation<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>By manually simulating the coagulation process, we can see the step-by-step changes in particle concentrations. This approach highlights the dynamic nature of coagulation and how it impacts particle size distributions in aerosols over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulating the coagulation process over time manually</span>

<span class="c1"># Define the time step for the simulation</span>
<span class="n">TIME_STEP</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># seconds</span>

<span class="c1"># Time step 1: Calculate the gain, loss, and net rate, then update concentration</span>

<span class="c1"># Calculate the rate of change in concentration (gain and loss) for the initial concentration</span>
<span class="n">gain</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_gain</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_0</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_loss</span><span class="p">(</span><span class="n">concentration_0</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">-</span> <span class="n">loss</span>  <span class="c1"># Net rate of change</span>

<span class="c1"># Update the concentration for the next time step</span>
<span class="n">concentration_1</span> <span class="o">=</span> <span class="n">concentration_0</span> <span class="o">+</span> <span class="n">net</span> <span class="o">*</span> <span class="n">TIME_STEP</span>

<span class="c1"># Time step 2: Recalculate rates with the updated concentration and update again</span>

<span class="c1"># Recalculate gain and loss based on the updated concentration from time step 1</span>
<span class="n">gain</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_gain</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_1</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_loss</span><span class="p">(</span><span class="n">concentration_1</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">-</span> <span class="n">loss</span>

<span class="c1"># Update the concentration for the next time step</span>
<span class="n">concentration_2</span> <span class="o">=</span> <span class="n">concentration_1</span> <span class="o">+</span> <span class="n">net</span> <span class="o">*</span> <span class="n">TIME_STEP</span>

<span class="c1"># Time step 3: Recalculate rates again and update concentration</span>

<span class="c1"># Recalculate gain and loss based on the updated concentration from time step 2</span>
<span class="n">gain</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_gain</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_2</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_loss</span><span class="p">(</span><span class="n">concentration_2</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">-</span> <span class="n">loss</span>

<span class="c1"># Update the concentration for the next time step</span>
<span class="n">concentration_3</span> <span class="o">=</span> <span class="n">concentration_2</span> <span class="o">+</span> <span class="n">net</span> <span class="o">*</span> <span class="n">TIME_STEP</span>

<span class="c1"># Print the maximum concentration at each time step to observe changes</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Concentration 0 max: </span><span class="si">{</span><span class="n">concentration_0</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Concentration 1 max: </span><span class="si">{</span><span class="n">concentration_1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Concentration 2 max: </span><span class="si">{</span><span class="n">concentration_2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Concentration 3 max: </span><span class="si">{</span><span class="n">concentration_3</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Combine the concentrations at each time step into a DataFrame for easy comparison</span>
<span class="n">df_concentration</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="n">concentration_0</span><span class="p">,</span>
        <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="n">concentration_1</span><span class="p">,</span>
        <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="n">concentration_2</span><span class="p">,</span>
        <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="n">concentration_3</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">index</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Display the first five rows of the DataFrame to inspect the concentration changes</span>
<span class="n">df_concentration</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Optional: Save the concentration data to a CSV file for further analysis</span>
<span class="c1"># df_concentration.to_csv(&quot;concentration_uniform_sim.csv&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Concentration 0 max: 100000000.0
Concentration 1 max: 1263633883.0015862
Concentration 2 max: 11241880825.442844
Concentration 3 max: 98778247873.61397
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.000000e-09</th>
      <td>100000000.0</td>
      <td>9.975226e+07</td>
      <td>9.765578e+07</td>
      <td>7.995004e+07</td>
    </tr>
    <tr>
      <th>2.782559e-09</th>
      <td>100000000.0</td>
      <td>9.996748e+07</td>
      <td>9.969288e+07</td>
      <td>9.733161e+07</td>
    </tr>
    <tr>
      <th>7.742637e-09</th>
      <td>100000000.0</td>
      <td>9.999565e+07</td>
      <td>9.995912e+07</td>
      <td>9.964448e+07</td>
    </tr>
    <tr>
      <th>2.154435e-08</th>
      <td>100000000.0</td>
      <td>9.999946e+07</td>
      <td>9.999441e+07</td>
      <td>9.995043e+07</td>
    </tr>
    <tr>
      <th>5.994843e-08</th>
      <td>100000000.0</td>
      <td>9.999807e+07</td>
      <td>9.999542e+07</td>
      <td>9.998650e+07</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="plotting-the-evolution-of-particle-concentration">
<h2>Plotting the Evolution of Particle Concentration<a class="headerlink" href="#plotting-the-evolution-of-particle-concentration" title="Link to this heading">#</a></h2>
<p>To visualize how particle concentrations evolve over time due to coagulation, we plot the concentration distributions at different time steps. This allows us to observe the changes in particle size distribution as the coagulation process progresses.</p>
<section id="id3">
<h3>Plot Details<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Time Step 0 (<code class="docutils literal notranslate"><span class="pre">t=0</span></code>)</strong>: The initial concentration distribution is plotted as a solid blue line. This serves as the baseline before any coagulation has occurred.</p></li>
<li><p><strong>Time Step 1 (<code class="docutils literal notranslate"><span class="pre">t=1</span></code>)</strong>: After the first time step, the concentration distribution is plotted as a dashed green line. This shows the immediate effect of coagulation on the particle distribution.</p></li>
<li><p><strong>Time Step 2 (<code class="docutils literal notranslate"><span class="pre">t=2</span></code>)</strong>: The concentration distribution at the second time step is plotted as a dash-dot orange line. By this point, we can begin to see more noticeable changes as particles coagulate.</p></li>
<li><p><strong>Time Step 3 (<code class="docutils literal notranslate"><span class="pre">t=3</span></code>)</strong>: Finally, the concentration distribution after the third time step is plotted as a dotted red line, illustrating further evolution of the particle sizes as the coagulation process continues.</p></li>
</ul>
</section>
<section id="id4">
<h3>Axes Configuration<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>X-axis</strong>: The x-axis represents the particle radius in meters, and is plotted on a logarithmic scale to capture the wide range of particle sizes.</p></li>
<li><p><strong>Y-axis</strong>: The y-axis shows the concentration in particles per cubic meter (m⁻³), also on a logarithmic scale to reflect the changes in concentration across orders of magnitude.</p></li>
</ul>
</section>
<section id="id5">
<h3>Interpretation<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p>As expected, smaller particles tend to coagulate into larger sizes, leading to changes in the overall distribution. This plot provides a visual representation of the dynamic nature of coagulation, making it easier to understand how particle populations evolve in an aerosol system.</p>
<p>The plot provides a visual representation of the dynamic nature of coagulation, making it easier to understand how particle populations evolve in an aerosol system.</p>
</section>
<section id="end-member-error">
<h3>End member Error<a class="headerlink" href="#end-member-error" title="Link to this heading">#</a></h3>
<p>Due to the underlying numerical integration assumptions, a flat distribution is not treated correctly at the largest sizes. But in real-world cases where the distribution is not flat, this error is not significant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the evolution of particle concentration over time</span>

<span class="c1"># Create a figure and axis object for the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the concentration distribution at each time step</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t=0&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t=1&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t=2&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t=3&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

<span class="c1"># Set the x-axis label to indicate the particle radius in meters</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Particle radius (m)&quot;</span><span class="p">)</span>

<span class="c1"># Set the y-axis label to indicate the concentration in particles per cubic meter</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Concentration $\dfrac</span><span class="si">{1}</span><span class="s2">{m^</span><span class="si">{3}</span><span class="s2">}$&quot;</span><span class="p">)</span>

<span class="c1"># Use logarithmic scales for both the x-axis and y-axis</span>
<span class="c1"># This helps in visualizing the broad range of particle sizes and concentration changes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="c1"># Add a legend to differentiate between the time steps</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/da798bc450cfef058aa467382dd3dd07e1975bbafebf61a8253ddffd7cbc89ab.png" src="../../../../_images/da798bc450cfef058aa467382dd3dd07e1975bbafebf61a8253ddffd7cbc89ab.png" />
</div>
</div>
</section>
</section>
<section id="lognormal-distribution">
<h2>Lognormal Distribution<a class="headerlink" href="#lognormal-distribution" title="Link to this heading">#</a></h2>
<p>In this section, we will implement the coagulation process for a lognormal particle size distribution. A lognormal distribution is more representative of real-world aerosol systems, where particles are not uniformly distributed in size but instead follow a distribution where most particles are centered around a particular size with fewer particles in the smaller and larger size ranges.</p>
<section id="why-lognormal-distribution">
<h3>Why Lognormal Distribution?<a class="headerlink" href="#why-lognormal-distribution" title="Link to this heading">#</a></h3>
<p>A lognormal distribution is often observed in natural aerosol populations due to the multiplicative processes that govern particle formation and growth. This distribution is characterized by a peak (or mode) at the most common particle size, with the number of particles decreasing logarithmically for sizes smaller and larger than the mode. Implementing coagulation for this distribution will provide a more realistic simulation of how aerosol particles behave in the atmosphere.</p>
<p>We will proceed by defining the lognormal size distribution, calculating the coagulation kernel, and then simulating the coagulation process over time, similar to what we did for the uniform distribution. This approach will allow us to compare the results between the uniform and lognormal distributions, highlighting the differences in coagulation dynamics based on initial particle size distributions.</p>
</section>
<section id="defining-the-radius-and-mass-bins">
<h3>Defining the Radius and Mass Bins<a class="headerlink" href="#defining-the-radius-and-mass-bins" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Radius Bins</strong>: We define the particle radius bins on a logarithmic scale ranging from 1 nanometer (1e-9 m) to 10 micrometers (1e-4 m). Using 250 bins ensures a fine resolution across this range, which is important for accurately representing the lognormal distribution.</p></li>
</ul>
</section>
<section id="generating-the-lognormal-distribution">
<h3>Generating the Lognormal Distribution<a class="headerlink" href="#generating-the-lognormal-distribution" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Lognormal Distribution</strong>: We generate the particle concentration using a lognormal distribution, which is characterized by:</p>
<ul>
<li><p>A <strong>mode</strong> (most probable size) of 100 nanometers (100 nm).</p></li>
<li><p>A <strong>geometric standard deviation</strong> of 1.4, which controls the spread of the distribution.</p></li>
<li><p>A <strong>total number concentration</strong> of 10000 particles per cubic centimeter (10000 cm⁻³), converted to particles per cubic meter for consistency with our units.</p></li>
</ul>
</li>
</ul>
</section>
<section id="plotting-the-lognormal-distribution">
<h3>Plotting the Lognormal Distribution<a class="headerlink" href="#plotting-the-lognormal-distribution" title="Link to this heading">#</a></h3>
<p>The resulting lognormal distribution is plotted with particle radius on the x-axis (logarithmic scale) and particle concentration on the y-axis. This plot visually demonstrates the lognormal distribution, showing a peak around the mode (100 nm) with concentrations decreasing for both smaller and larger particles.</p>
<p>This setup provides a more realistic starting point for simulating the coagulation process in an aerosol system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define fine scale radius bins and corresponding mass bins for a lognormal distribution</span>

<span class="c1"># Create fine scale radius bins on a logarithmic scale from 1 nm to 10 μm</span>
<span class="n">radius_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mi">9</span><span class="p">,</span> <span class="n">stop</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>  <span class="c1"># m (1 nm to 10 μm)</span>

<span class="c1"># Calculate the mass for each particle size bin assuming a density of 1 g/cm^3 (1000 kg/m^3)</span>
<span class="n">mass_bins</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius_bins</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="mf">1e3</span>  <span class="c1"># kg</span>

<span class="c1"># Generate a lognormal particle size distribution</span>
<span class="c1"># This distribution is characterized by a mode (most probable size) of 100 nm,</span>
<span class="c1"># a geometric standard deviation of 1.4, and a total number concentration of 10000 particles per cm^3.</span>
<span class="n">concentration_lognormal_0</span> <span class="o">=</span> <span class="n">lognormal_pmf_distribution</span><span class="p">(</span>
    <span class="n">x_values</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">100e-9</span><span class="p">),</span>  <span class="c1"># Mode of the distribution (100 nm)</span>
    <span class="n">geometric_standard_deviation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.4</span><span class="p">),</span>  <span class="c1"># Geometric standard deviation</span>
    <span class="n">number_of_particles</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="mf">1e6</span> <span class="o">*</span> <span class="mf">1e6</span>  <span class="c1"># Total concentration (10000 cm^-3 converted to m^-3)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Plot the lognormal concentration distribution</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_lognormal_0</span><span class="p">)</span>

<span class="c1"># Set the x-axis to a logarithmic scale to capture the wide range of particle sizes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Particle radius (m)&quot;</span><span class="p">)</span>

<span class="c1"># Label the y-axis to show the concentration in particles per cubic meter</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Concentration $\dfrac</span><span class="si">{1}</span><span class="s2">{m^</span><span class="si">{3}</span><span class="s2">}$&quot;</span><span class="p">)</span>

<span class="c1"># Use a logarithmic scale for the x-axis to better visualize the distribution across particle sizes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="c1"># Set Title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;PMF: Lognormal Particle Size Distribution&quot;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/8350fb43885d7872347f4309f9ae024683462e6e654538b169d2f87fce1aaaf9.png" src="../../../../_images/8350fb43885d7872347f4309f9ae024683462e6e654538b169d2f87fce1aaaf9.png" />
</div>
</div>
</section>
</section>
<section id="simulating-the-coagulation-process-for-a-lognormal-distribution">
<h2>Simulating the Coagulation Process for a Lognormal Distribution<a class="headerlink" href="#simulating-the-coagulation-process-for-a-lognormal-distribution" title="Link to this heading">#</a></h2>
<p>Having established a lognormal particle size distribution, we now proceed to simulate the coagulation process over time. This simulation will show how the distribution evolves as particles coagulate and form larger particles.</p>
<section id="id6">
<h3>Simulation Setup<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Time Step</strong>: We set a time step of 100 seconds (<code class="docutils literal notranslate"><span class="pre">TIME_STEP</span> <span class="pre">=</span> <span class="pre">100</span></code>). This interval determines how frequently the particle concentrations are updated based on the calculated coagulation rates.</p></li>
<li><p><strong>Coagulation Kernel</strong>: The coagulation kernel is calculated using the same parameters as before (temperature, pressure, and perfect collision efficiency). The kernel remains constant throughout the simulation as it only depends on the physical properties of the particles and the environment.</p></li>
</ul>
</section>
<section id="time-step-calculations">
<h3>Time Step Calculations<a class="headerlink" href="#time-step-calculations" title="Link to this heading">#</a></h3>
<p>For each time step, we calculate the gain, loss, and net change in particle concentration:</p>
<ol class="arabic simple">
<li><p><strong>Time Step 1</strong>:</p>
<ul class="simple">
<li><p>Calculate the gain and loss rates for the initial concentration (<code class="docutils literal notranslate"><span class="pre">concentration_lognormal_0</span></code>).</p></li>
<li><p>Update the concentration to <code class="docutils literal notranslate"><span class="pre">concentration_lognormal_1</span></code> by applying the net rate of change. Any negative concentrations resulting from numerical errors are set to zero.</p></li>
</ul>
</li>
<li><p><strong>Time Step 2</strong>:</p>
<ul class="simple">
<li><p>Recalculate the gain and loss rates based on <code class="docutils literal notranslate"><span class="pre">concentration_lognormal_1</span></code>.</p></li>
<li><p>Update the concentration to <code class="docutils literal notranslate"><span class="pre">concentration_lognormal_2</span></code> and ensure no negative values.</p></li>
</ul>
</li>
<li><p><strong>Time Step 3</strong>:</p>
<ul class="simple">
<li><p>Recalculate the rates again based on <code class="docutils literal notranslate"><span class="pre">concentration_lognormal_2</span></code>.</p></li>
<li><p>Update the concentration to <code class="docutils literal notranslate"><span class="pre">concentration_lognormal_3</span></code>, correcting any negative values.</p></li>
</ul>
</li>
</ol>
</section>
<section id="combining-results">
<h3>Combining Results<a class="headerlink" href="#combining-results" title="Link to this heading">#</a></h3>
<p>The concentrations at each time step are combined into a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> DataFrame. This structure allows for easy comparison of how the particle size distribution changes over time due to coagulation.</p>
</section>
<section id="id7">
<h3>Optional: Saving Results<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<p>The resulting concentration data can be saved to a CSV file for further analysis or visualization. This step is optional but useful for documenting the evolution of the lognormal distribution over time.</p>
</section>
<section id="id8">
<h3>Interpretation<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<p>By simulating the coagulation process for a lognormal distribution, we can observe how initially peaked distributions broaden and shift as particles merge. The correction for negative concentrations ensures that the physical constraints of the system (i.e., non-negative particle counts) are respected throughout the simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulating the coagulation process over time for a lognormal distribution</span>

<span class="c1"># Define the time step for the simulation</span>
<span class="n">TIME_STEP</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># seconds</span>

<span class="c1"># Calculate the coagulation kernel</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">brownian_kernel</span><span class="o">.</span><span class="n">brownian_coagulation_kernel_via_system_state</span><span class="p">(</span>
    <span class="n">radius_particle</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">,</span>
    <span class="n">mass_particle</span><span class="o">=</span><span class="n">mass_bins</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mf">293.15</span><span class="p">,</span>  <span class="c1"># Temperature in Kelvin</span>
    <span class="n">pressure</span><span class="o">=</span><span class="mi">101325</span><span class="p">,</span>  <span class="c1"># Pressure in Pascals (1 atm)</span>
    <span class="n">alpha_collision_efficiency</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Assume perfect collision efficiency</span>
<span class="p">)</span>

<span class="c1"># Time step 1: Calculate gain, loss, and update concentration</span>
<span class="n">gain</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_gain</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_lognormal_0</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_loss</span><span class="p">(</span><span class="n">concentration_lognormal_0</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">-</span> <span class="n">loss</span>
<span class="n">concentration_lognormal_1</span> <span class="o">=</span> <span class="n">concentration_lognormal_0</span> <span class="o">+</span> <span class="n">net</span> <span class="o">*</span> <span class="n">TIME_STEP</span>
<span class="n">concentration_lognormal_1</span><span class="p">[</span><span class="n">concentration_lognormal_1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">0</span>  <span class="c1"># Ensure no negative concentrations</span>
<span class="p">)</span>

<span class="c1"># Time step 2: Recalculate rates and update concentration</span>
<span class="n">gain</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_gain</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_lognormal_1</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_loss</span><span class="p">(</span><span class="n">concentration_lognormal_1</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">-</span> <span class="n">loss</span>
<span class="n">concentration_lognormal_2</span> <span class="o">=</span> <span class="n">concentration_lognormal_1</span> <span class="o">+</span> <span class="n">net</span> <span class="o">*</span> <span class="n">TIME_STEP</span>
<span class="n">concentration_lognormal_2</span><span class="p">[</span><span class="n">concentration_lognormal_2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">0</span>  <span class="c1"># Ensure no negative concentrations</span>
<span class="p">)</span>

<span class="c1"># Time step 3: Recalculate rates and update concentration</span>
<span class="n">gain</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_gain</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">concentration_lognormal_2</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">discrete_loss</span><span class="p">(</span><span class="n">concentration_lognormal_2</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">-</span> <span class="n">loss</span>
<span class="n">concentration_lognormal_3</span> <span class="o">=</span> <span class="n">concentration_lognormal_2</span> <span class="o">+</span> <span class="n">net</span> <span class="o">*</span> <span class="n">TIME_STEP</span>
<span class="n">concentration_lognormal_3</span><span class="p">[</span><span class="n">concentration_lognormal_3</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">0</span>  <span class="c1"># Ensure no negative concentrations</span>
<span class="p">)</span>

<span class="c1"># Combine the concentrations at each time step into a DataFrame for easy comparison</span>
<span class="n">df_concentration</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;0&quot;</span><span class="p">:</span> <span class="n">concentration_lognormal_0</span><span class="p">,</span>
        <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="n">concentration_lognormal_1</span><span class="p">,</span>
        <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="n">concentration_lognormal_2</span><span class="p">,</span>
        <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="n">concentration_lognormal_3</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">index</span><span class="o">=</span><span class="n">radius_bins</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Optional: Save the concentration data to a CSV file for further analysis</span>
<span class="c1"># df_concentration.to_csv(&quot;concentration_lognormal_sim.csv&quot;)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="analyzing-concentration-extremes-over-time">
<h2>Analyzing Concentration Extremes Over Time<a class="headerlink" href="#analyzing-concentration-extremes-over-time" title="Link to this heading">#</a></h2>
<p>To gain insights into how the particle concentrations evolve during the coagulation process, it’s important to track the maximum and minimum concentrations at each time step. These values can provide valuable information about the stability and dynamics of the particle distribution.</p>
<section id="concentration-extremes">
<h3>Concentration Extremes<a class="headerlink" href="#concentration-extremes" title="Link to this heading">#</a></h3>
<p>We print the maximum and minimum concentrations for each time step:</p>
<ul class="simple">
<li><p><strong>Time Step 0 (<code class="docutils literal notranslate"><span class="pre">t=0</span></code>)</strong>:</p>
<ul>
<li><p><strong>Max Concentration</strong>: This represents the highest concentration of particles at the initial distribution.</p></li>
<li><p><strong>Min Concentration</strong>: This represents the lowest concentration at the initial distribution.</p></li>
</ul>
</li>
<li><p><strong>Time Step 1 (<code class="docutils literal notranslate"><span class="pre">t=1</span></code>)</strong>:</p>
<ul>
<li><p><strong>Max Concentration</strong>: After the first time step, we observe the highest concentration to see how it compares with the initial state.</p></li>
<li><p><strong>Min Concentration</strong>: Similarly, the lowest concentration is noted, which may indicate the depletion of certain particle sizes.</p></li>
</ul>
</li>
<li><p><strong>Time Step 2 (<code class="docutils literal notranslate"><span class="pre">t=2</span></code>)</strong>:</p>
<ul>
<li><p><strong>Max Concentration</strong>: As the simulation progresses, the peak concentration may shift due to ongoing coagulation.</p></li>
<li><p><strong>Min Concentration</strong>: Continued tracking of the minimum concentration helps in understanding the impact of coagulation on smaller particle sizes.</p></li>
</ul>
</li>
<li><p><strong>Time Step 3 (<code class="docutils literal notranslate"><span class="pre">t=3</span></code>)</strong>:</p>
<ul>
<li><p><strong>Max Concentration</strong>: The final maximum concentration provides an overview of how the distribution has evolved.</p></li>
<li><p><strong>Min Concentration</strong>: The minimum concentration may highlight which particle sizes have been most affected by coagulation.</p></li>
</ul>
</li>
</ul>
</section>
<section id="id9">
<h3>Interpretation<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>By examining these extremes, we can infer the following:</p>
<ul class="simple">
<li><p><strong>Max Concentration</strong>: Changes in the maximum concentration over time can indicate the formation of larger particles as smaller ones coagulate. A decrease in max concentration suggests that the most abundant particle size at earlier steps is merging with others, leading to a broader or shifted distribution.</p></li>
<li><p><strong>Min Concentration</strong>: The minimum concentration helps identify whether certain particle sizes are becoming scarce due to coagulation, which may cause those bins to empty out or reduce significantly.</p></li>
</ul>
<p>This analysis is crucial for understanding the dynamic behavior of the particle size distribution under coagulation and for ensuring that the simulation reflects realistic physical constraints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the maximum and minimum concentrations at each time step</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max concentration at t=0: </span><span class="si">{</span><span class="n">concentration_lognormal_0</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min concentration at t=0: </span><span class="si">{</span><span class="n">concentration_lognormal_0</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max concentration at t=1: </span><span class="si">{</span><span class="n">concentration_lognormal_1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min concentration at t=1: </span><span class="si">{</span><span class="n">concentration_lognormal_1</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max concentration at t=2: </span><span class="si">{</span><span class="n">concentration_lognormal_2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min concentration at t=2: </span><span class="si">{</span><span class="n">concentration_lognormal_2</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max concentration at t=3: </span><span class="si">{</span><span class="n">concentration_lognormal_3</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min concentration at t=3: </span><span class="si">{</span><span class="n">concentration_lognormal_3</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Max concentration at t=0: 54738275267.16476
Min concentration at t=0: 1.6445825598006672e-81
Max concentration at t=1: 51186782324.56813
Min concentration at t=1: 0.0
Max concentration at t=2: 48026245801.09982
Min concentration at t=2: 0.0
Max concentration at t=3: 45351022236.99084
Min concentration at t=3: 0.0
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="plotting-the-coagulation-gain-loss-and-net-rates-for-lognormal-distribution">
<h2>Plotting the Coagulation Gain, Loss, and Net Rates for Lognormal Distribution<a class="headerlink" href="#plotting-the-coagulation-gain-loss-and-net-rates-for-lognormal-distribution" title="Link to this heading">#</a></h2>
<p>To visualize the dynamics of coagulation for a lognormal particle size distribution, we plot the rates of gain, loss, and net change in concentration across the range of particle sizes. This plot provides insights into how particles are interacting during the coagulation process.</p>
<section id="id10">
<h3>Plot Details<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Net Rate</strong>: The net rate of change in particle concentration is plotted as a thick gray line. This line represents the overall effect of coagulation, indicating whether the concentration in each size bin is increasing or decreasing.</p></li>
<li><p><strong>Gain Rate</strong>: The gain rate, plotted in dark green, shows how particles are being added to each size bin as smaller particles coagulate to form larger ones. This rate reflects the accumulation of particles in specific size bins.</p></li>
<li><p><strong>Loss Rate</strong>: The loss rate is plotted in red, with the values multiplied by -1 to indicate that it represents a reduction in particle concentration. This line shows how particles are being depleted from each size bin due to coagulation.</p></li>
</ul>
</section>
<section id="id11">
<h3>Axes Configuration<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>X-axis</strong>: The x-axis represents the particle radius in meters, plotted on a logarithmic scale to capture the wide range of particle sizes present in the distribution.</p></li>
<li><p><strong>Y-axis</strong>: The y-axis shows the rate of change in concentration in units of particles per cubic meter per second (<span class="math notranslate nohighlight">\(\dfrac{1}{m^{3} s^{1}}\)</span>), providing a clear view of how rapidly particles are being gained, lost, or changing net concentration in the system.</p></li>
</ul>
</section>
<section id="legend-and-interpretation">
<h3>Legend and Interpretation<a class="headerlink" href="#legend-and-interpretation" title="Link to this heading">#</a></h3>
<p>A legend is included to clearly differentiate between the net, gain, and loss lines on the plot. By analyzing these rates, we can determine the most active particle sizes in the coagulation process:</p>
<ul class="simple">
<li><p><strong>Positive Net Rate</strong>: Indicates that the particle size bin is gaining particles, likely due to the aggregation of smaller particles.</p></li>
<li><p><strong>Negative Net Rate</strong>: Indicates that the particle size bin is losing particles, either because they are merging into larger particles or being depleted through other processes.</p></li>
</ul>
<p>This plot is essential for understanding the detailed behavior of the particle size distribution during coagulation, highlighting which sizes are most affected by the process.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the coagulation gain, loss, and net rates for the lognormal distribution</span>

<span class="c1"># Create a figure and axis object for the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the net coagulation rate</span>
<span class="c1"># The net rate is plotted with a thicker gray line for emphasis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Net&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Plot the gain rate</span>
<span class="c1"># The gain rate is plotted in dark green</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gain&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">)</span>

<span class="c1"># Plot the loss rate</span>
<span class="c1"># The loss rate is plotted in red, and multiplied by -1 for plotting to indicate that it&#39;s a removal process</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">radius_bins</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Loss&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

<span class="c1"># Set the x-axis label to indicate the particle radius in meters</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Particle radius (m)&quot;</span><span class="p">)</span>

<span class="c1"># Set the y-axis label to indicate the rate of change in concentration, with appropriate units</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Rate $\dfrac</span><span class="si">{1}</span><span class="s2">{m^</span><span class="si">{3}</span><span class="s2"> s^</span><span class="si">{1}</span><span class="s2">}$&quot;</span><span class="p">)</span>

<span class="c1"># Use a logarithmic scale for the x-axis to account for the wide range of particle sizes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

<span class="c1"># set title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;PMF: Coagulation gain, loss, and net rates&quot;</span><span class="p">)</span>

<span class="c1"># Add a legend to identify the gain, loss, and net lines</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/35cdb86dbfd1c3b893805197d351e31e32d8354db426c2ce383a51d2d52bb4b1.png" src="../../../../_images/35cdb86dbfd1c3b893805197d351e31e32d8354db426c2ce383a51d2d52bb4b1.png" />
</div>
</div>
</section>
</section>
<section id="plotting-the-evolution-of-concentration-for-lognormal-distribution">
<h2>Plotting the Evolution of Concentration for Lognormal Distribution<a class="headerlink" href="#plotting-the-evolution-of-concentration-for-lognormal-distribution" title="Link to this heading">#</a></h2>
<p>After simulating the coagulation process over several time steps, it is important to visualize how the particle concentration evolves. This plot shows the concentration distribution at different time steps, allowing us to observe the changes in the lognormal distribution as coagulation progresses.</p>
<section id="id12">
<h3>Plot Details<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Time Step 0 (<code class="docutils literal notranslate"><span class="pre">t=0</span></code>)</strong>: The initial concentration distribution is plotted as a solid blue line. This represents the starting point of the simulation, with a lognormal distribution centered around the mode.</p></li>
<li><p><strong>Time Step 1 (<code class="docutils literal notranslate"><span class="pre">t=1</span></code>)</strong>: After the first time step, the concentration distribution is plotted as a dashed green line. This line shows the immediate impact of coagulation on the particle sizes.</p></li>
<li><p><strong>Time Step 2 (<code class="docutils literal notranslate"><span class="pre">t=2</span></code>)</strong>: The concentration distribution at the second time step is plotted as a dash-dot orange line. By this time, noticeable shifts in the distribution may start to appear as particles coagulate.</p></li>
<li><p><strong>Time Step 3 (<code class="docutils literal notranslate"><span class="pre">t=3</span></code>)</strong>: Finally, the concentration distribution after the third time step is plotted as a dotted red line. This line illustrates further evolution of the distribution, highlighting the ongoing effects of coagulation.</p></li>
</ul>
</section>
<section id="id13">
<h3>Axes Configuration<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>X-axis</strong>: The x-axis represents the particle radius in meters, plotted on a logarithmic scale to cover the wide range of particle sizes in the lognormal distribution.</p></li>
<li><p><strong>Y-axis</strong>: The y-axis shows the concentration in particles per cubic meter (m⁻³), also plotted on a logarithmic scale to reflect the broad range of concentrations.</p></li>
</ul>
</section>
<section id="id14">
<h3>Interpretation<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
<p>By comparing the concentration distributions at different time steps, you can observe how the lognormal distribution shifts and broadens as particles coagulate. Typically, the concentration of smaller particles decreases over time as they merge to form larger particles, leading to an increase in the concentration of larger particles. This visualization provides a clear, temporal view of the coagulation process and its effects on the particle size distribution.</p>
<p>This plot is crucial for understanding the dynamic evolution of aerosol particles under coagulation, particularly when starting with a realistic lognormal distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the evolution of particle concentration over time for the lognormal distribution</span>

<span class="c1"># Create a figure and axis object for the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the concentration distribution at each time step</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">radius_bins</span><span class="p">,</span>
    <span class="n">concentration_lognormal_0</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t=0&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">radius_bins</span><span class="p">,</span>
    <span class="n">concentration_lognormal_1</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t=1&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">radius_bins</span><span class="p">,</span>
    <span class="n">concentration_lognormal_2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t=2&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">radius_bins</span><span class="p">,</span>
    <span class="n">concentration_lognormal_3</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;t=3&quot;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Set the x-axis label to indicate the particle radius in meters</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Particle radius (m)&quot;</span><span class="p">)</span>

<span class="c1"># Set the y-axis label to indicate the concentration in particles per cubic meter</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Concentration $\dfrac</span><span class="si">{1}</span><span class="s2">{m^</span><span class="si">{3}</span><span class="s2">}$&quot;</span><span class="p">)</span>

<span class="c1"># set title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;PMF: Particle concentration evolution over time&quot;</span><span class="p">)</span>

<span class="c1"># Use a logarithmic scale for both the x-axis and y-axis</span>
<span class="c1"># This is essential for visualizing the wide range of particle sizes and concentration changes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="c1"># ax.set_yscale(&quot;log&quot;)</span>

<span class="c1"># Add a legend to differentiate between the time steps</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/43e046c043e1216116e6b3fdbdb2b39b8f6a086a261b13260fb14a8a32b11537.png" src="../../../../_images/43e046c043e1216116e6b3fdbdb2b39b8f6a086a261b13260fb14a8a32b11537.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="total-concentration-over-time">
<h1>Total Concentration Over Time<a class="headerlink" href="#total-concentration-over-time" title="Link to this heading">#</a></h1>
<p>To understand the overall impact of coagulation on the particle population, it is essential to track the total concentration of particles over time. This plot shows how the total concentration changes as particles coagulate and form larger sizes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Summation of PMF distribution</span>
<span class="c1"># Calculate the total concentration of particles at each time step</span>
<span class="n">total_concentration_0</span> <span class="o">=</span> <span class="n">concentration_lognormal_0</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">total_concentration_1</span> <span class="o">=</span> <span class="n">concentration_lognormal_1</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">total_concentration_2</span> <span class="o">=</span> <span class="n">concentration_lognormal_2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">total_concentration_3</span> <span class="o">=</span> <span class="n">concentration_lognormal_3</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Create a figure and axis object for the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the total concentration at each time step</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="p">[</span><span class="n">total_concentration_0</span><span class="p">,</span> <span class="n">total_concentration_1</span><span class="p">,</span> <span class="n">total_concentration_2</span><span class="p">,</span> <span class="n">total_concentration_3</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Total concentration&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>  <span class="c1"># Add markers to indicate each time step</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>  <span class="c1"># Use a solid line to connect the markers</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>  <span class="c1"># Set the line color to blue</span>
<span class="p">)</span>

<span class="c1"># Set the x-axis label to indicate the time step</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time step&quot;</span><span class="p">)</span>

<span class="c1"># Set the y-axis label to indicate the total concentration in particles per cubic meter</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Total concentration $(m^{-3})$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.84e12</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;PMF: Total concentration at each time step&quot;</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/1a7c383ed3a0394ed0b167dbde7ce5132ed27a038ec2356fdc669439f5d42186.png" src="../../../../_images/1a7c383ed3a0394ed0b167dbde7ce5132ed27a038ec2356fdc669439f5d42186.png" />
</div>
</div>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>In this notebook, we explored the process of particle coagulation in aerosols, focusing on both uniform and lognormal particle size distributions. The notebook provided a step-by-step implementation of the coagulation process, highlighting key concepts and calculations necessary to simulate the dynamic behavior of aerosol particles over time.</p>
<section id="key-steps-and-findings">
<h3>Key Steps and Findings:<a class="headerlink" href="#key-steps-and-findings" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Coagulation Basics</strong>:</p>
<ul class="simple">
<li><p>We began with a uniform particle size distribution to introduce the fundamental concepts of coagulation, including the calculation of the Brownian coagulation kernel and the rates of particle gain, loss, and net change.</p></li>
<li><p>The initial uniform distribution allowed us to understand the basic mechanics of how particles interact and merge over time.</p></li>
</ul>
</li>
<li><p><strong>Transition to Lognormal Distribution</strong>:</p>
<ul class="simple">
<li><p>We then shifted to a more realistic lognormal particle size distribution, which better represents real-world aerosol systems. This distribution was characterized by a mode (most probable particle size), a geometric standard deviation, and a total number concentration.</p></li>
<li><p>The coagulation process was simulated for this lognormal distribution, with the particle concentrations updated over several discrete time steps.</p></li>
</ul>
</li>
<li><p><strong>Simulation and Visualization</strong>:</p>
<ul class="simple">
<li><p>The evolution of the particle size distribution was tracked over time, with plots showing the changes in concentration for different particle sizes. These plots illustrated how smaller particles gradually merge to form larger ones, leading to a shift and broadening of the distribution.</p></li>
<li><p>The rates of particle gain, loss, and net change were also visualized, providing insights into the most active particle sizes during the coagulation process.</p></li>
</ul>
</li>
<li><p><strong>Key Insights</strong>:</p>
<ul class="simple">
<li><p>The notebook demonstrated that coagulation leads to a decrease in the number concentration of smaller particles as they coalesce to form larger particles. This results in a broader size distribution with fewer small particles and an increased concentration of larger particles.</p></li>
<li><p>The lognormal distribution, due to its realistic representation of aerosol particles, showed more complex dynamics compared to the uniform distribution, emphasizing the importance of starting with an appropriate initial distribution in simulations.</p></li>
</ul>
</li>
</ol>
</section>
<section id="conclusion">
<h3>Conclusion:<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h3>
<p>This notebook provided a guide to simulating the coagulation process in aerosol particles, from basic principles to more advanced applications involving realistic size distributions. By comparing the results from uniform and lognormal distributions, we gained a deeper understanding of how particle populations evolve under coagulation, highlighting the critical role of particle size distribution in aerosol dynamics. The methods and visualizations presented here can be extended to further study and analyze aerosol behavior in various environmental and industrial contexts.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "uncscode/particula",
            ref: "v0.0.10",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Tutorials/Dynamics/Coagulation/Functional"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Coagulation Basic 1: PMF Representation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direct-implementation-for-discrete-particle-size-distributions">Direct Implementation for Discrete Particle Size Distributions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#objective">Objective</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#approach">Approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#required-libraries">Required Libraries</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-size-distribution">Creating a Size Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#particle-size-bins">Particle Size Bins</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#particle-mass-calculation">Particle Mass Calculation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-the-brownian-coagulation-kernel">Calculating the Brownian Coagulation Kernel</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-calculation">Kernel Calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzing-the-kernel">Analyzing the Kernel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-a-dataframe">Creating a DataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-saving-the-kernel-matrix">Optional: Saving the Kernel Matrix</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-brownian-coagulation-kernel">Plotting the Brownian Coagulation Kernel</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-setup">Visualization Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#axes-configuration">Axes Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-y-axis-logarithmic-scale">Optional Y-axis Logarithmic Scale</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-particle-concentrations">Adding Particle Concentrations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-concentration-setup">Initial Concentration Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-the-initial-concentration">Visualization of the Initial Concentration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importance-of-concentration">Importance of Concentration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coagulation-rate-calculation">Coagulation Rate Calculation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gain-loss-and-net-rate-calculation">Gain, Loss, and Net Rate Calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#displaying-results">Displaying Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-coagulation-gain-loss-and-net-rates">Plotting the Coagulation Gain, Loss, and Net Rates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-details">Plot Details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Axes Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation">Interpretation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-the-coagulation-process-over-time">Simulating the Coagulation Process Over Time</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-setup">Simulation Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-step-1">Time Step 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-step-2">Time Step 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-step-3">Time Step 3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observing-changes">Observing Changes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframe-creation">DataFrame Creation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-saving-results">Optional: Saving Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Interpretation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-evolution-of-particle-concentration">Plotting the Evolution of Particle Concentration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Plot Details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Axes Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Interpretation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#end-member-error">End member Error</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lognormal-distribution">Lognormal Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-lognormal-distribution">Why Lognormal Distribution?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-radius-and-mass-bins">Defining the Radius and Mass Bins</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-the-lognormal-distribution">Generating the Lognormal Distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-lognormal-distribution">Plotting the Lognormal Distribution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-the-coagulation-process-for-a-lognormal-distribution">Simulating the Coagulation Process for a Lognormal Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Simulation Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-step-calculations">Time Step Calculations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-results">Combining Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Optional: Saving Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Interpretation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzing-concentration-extremes-over-time">Analyzing Concentration Extremes Over Time</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#concentration-extremes">Concentration Extremes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Interpretation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-coagulation-gain-loss-and-net-rates-for-lognormal-distribution">Plotting the Coagulation Gain, Loss, and Net Rates for Lognormal Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Plot Details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Axes Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#legend-and-interpretation">Legend and Interpretation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-evolution-of-concentration-for-lognormal-distribution">Plotting the Evolution of Concentration for Lognormal Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Plot Details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Axes Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Interpretation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#total-concentration-over-time">Total Concentration Over Time</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-steps-and-findings">Key Steps and Findings:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion:</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By particula contributors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>